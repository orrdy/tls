<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THAILAND LOCKSMITH 2025</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7/dist/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/v/bs5/dt-2.1.8/b-3.1.2/date-1.5.4/fh-4.0.1/r-3.0.3/datatables.min.css"
        rel="stylesheet">
    <!-- icon -->
    <link rel="icon" href="https://img2.pic.in.th/pic/1763797945554.png" type="image/x-icon">
    <script
        src="https://cdn.datatables.net/v/bs5/dt-2.1.8/b-3.1.2/date-1.5.4/fh-4.0.1/r-3.0.3/datatables.min.js"></script>



    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, #ff8f04 0%, #ffad42 100%);
            min-height: 100vh;
            padding: 10px 0;
        }

        .container {
            max-width: 440px;
        }

        /* Modern Card Design */
        .card-modern {
            background: white;
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .card-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
        }

        /* Header Styles */
        .header-modern {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            border-radius: 24px;
            padding: 32px 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .header-modern::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        }


        .header-modern img {
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .header-text {
            color: #ff8f04;
            position: relative;
            z-index: 1;
        }

        /* Modern Button Styles */
        .btn-card {
            position: relative;
            overflow: hidden;
            border: none;
            border-radius: 20px;
            padding: 20px 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            cursor: pointer;
        }

        .btn-card::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-card:hover::before {
            width: 400px;
            height: 400px;
        }

        .btn-orange {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: #ff8f04;
            font-weight: 600;
            border: 2px solid #ff8f04;
        }

        .btn-orange:hover {
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            border-color: #000;
        }

        .btn-gold {
            background: linear-gradient(135deg, #1a1a1a 0%, #333333 100%);
            color: #ffad42;
            font-weight: 600;
            border: 2px solid #ffad42;
        }

        .btn-gold:hover {
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            border-color: #000;
        }

        .btn-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.2);
            margin-left: 12px;
            transition: all 0.3s ease;
        }

        .btn-card:hover .btn-icon {
            transform: translateX(4px);
            background: rgba(0, 0, 0, 0.3);
        }

        .form-control {
            background-color: #f5f5f5;
            color: #333;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 12px 16px;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .form-control:focus {
            background-color: #fff;
            border-color: #ff8f04;
            box-shadow: 0 0 0 4px rgba(255, 143, 4, 0.15);
            outline: none;
        }

        form label {
            font-size: 0.95rem !important;
            color: #4b4b49;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-check-input {
            width: 22px;
            height: 22px;
            margin-right: 12px;
            border: 2px solid #ccc;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-check-input:checked {
            background-color: #ff8f04;
            border-color: #ff8f04;
        }

        .submit-btn {
            font-weight: 700;
            color: #fff;
            background: linear-gradient(135deg, #ff8f04 0%, #ff6f00 100%);
            padding: 16px 48px;
            border: none;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(255, 143, 4, 0.5);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1.1rem;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(255, 143, 4, 0.8);
            background: linear-gradient(135deg, #ff6f00 0%, #e65100 100%);
        }

        .submit-btn:active {
            transform: translateY(0px);
        }

        /* DataTables styling */
        table {
            tr {

                th,
                td {
                    vertical-align: middle;
                }
            }
        }

        .table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }

        /* Modal styling */
        .modal-header {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: #ff8f04;
            border-bottom: none;
        }

        .modal-header .btn-close {
            filter: invert(1);
        }

        /* Loading Overlay */
        .loadingoverlay {
            background: linear-gradient(135deg, rgba(255, 143, 4, 0.65) 0%, rgba(255, 173, 66, 0.65) 100%) !important;
        }

        /* Custom SweetAlert2 Styles - Theme Colors */
        .swal2-popup {
            border-radius: 24px !important;
            padding: 2em !important;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2) !important;
        }

        .swal2-title {
            color: #000000 !important;
            font-weight: 700 !important;
            font-family: 'Prompt', sans-serif !important;
            font-size: 1.75rem !important;
        }

        .swal2-html-container {
            color: #333333 !important;
            font-family: 'Prompt', sans-serif !important;
            font-size: 1rem !important;
            line-height: 1.6 !important;
        }

        /* Confirm Button - Orange Theme */
        .swal2-confirm {
            background: linear-gradient(135deg, #ff8f04 0%, #ff6f00 100%) !important;
            color: #ffffff !important;
            border: none !important;
            border-radius: 50px !important;
            padding: 12px 32px !important;
            font-weight: 600 !important;
            font-family: 'Prompt', sans-serif !important;
            box-shadow: 0 4px 20px rgba(255, 143, 4, 0.4) !important;
            transition: all 0.3s ease !important;
            font-size: 1rem !important;
        }

        .swal2-confirm:hover {
            background: linear-gradient(135deg, #ff6f00 0%, #e65100 100%) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 25px rgba(255, 143, 4, 0.6) !important;
        }

        .swal2-confirm:focus {
            box-shadow: 0 0 0 4px rgba(255, 143, 4, 0.3) !important;
        }

        /* Cancel Button - Dark Theme */
        .swal2-cancel {
            background: linear-gradient(135deg, #1a1a1a 0%, #333333 100%) !important;
            color: #ff8f04 !important;
            border: 2px solid #ff8f04 !important;
            border-radius: 50px !important;
            padding: 12px 32px !important;
            font-weight: 600 !important;
            font-family: 'Prompt', sans-serif !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important;
            transition: all 0.3s ease !important;
            font-size: 1rem !important;
        }

        .swal2-cancel:hover {
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%) !important;
            color: #000000 !important;
            border-color: #000000 !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3) !important;
        }

        .swal2-cancel:focus {
            box-shadow: 0 0 0 4px rgba(255, 143, 4, 0.2) !important;
        }

        /* Icon Colors */
        .swal2-icon.swal2-success {
            border-color: #ff8f04 !important;
            color: #ff8f04 !important;
        }

        .swal2-success-ring {
            border-color: rgba(255, 143, 4, 0.3) !important;
        }

        .swal2-icon.swal2-success [class^='swal2-success-line'] {
            background-color: #ff8f04 !important;
        }

        .swal2-icon.swal2-error {
            border-color: #dc3545 !important;
        }

        .swal2-icon.swal2-error [class^='swal2-x-mark-line'] {
            background-color: #dc3545 !important;
        }

        .swal2-icon.swal2-warning {
            border-color: #ffad42 !important;
            color: #ffad42 !important;
        }

        .swal2-icon.swal2-info {
            border-color: #ff8f04 !important;
            color: #ff8f04 !important;
        }

        .swal2-icon.swal2-question {
            border-color: #ff8f04 !important;
            color: #ff8f04 !important;
        }

        /* Responsive */
        @media (max-width: 576px) {
            .container-fluid {
                padding: 0 16px;
            }

            .card-modern {
                padding: 20px;
                border-radius: 20px;
            }

            .header-modern {
                padding: 24px 20px;
                border-radius: 20px;
            }
        }
    </style>
</head>

<body>
    <div class="container-fluid" id="scan-div">
        <div class="row justify-content-center m-1 rounded-3 d-none m-0 p-0" id="qrdiv">
            <div class="row justify-content-center m-0 p-0">
                <div class="col-md-6 m-0 p-0">
                    <div id="reader" class="img-fluid m-0 p-0"></div>
                </div>
            </div>
            <div class="row justify-content-center">
                <button class="btn btn-secondary fixed-top rounded-0" id="cancel-btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>
    <div class="container-fluid" id="btn-div">
        <header class="header-modern container-fluid d-flex flex-column justify-content-center align-items-center">
            <img src="https://img2.pic.in.th/pic/1763797945554.png" alt="" style="width: 100px; max-height: 100px;"
                class="img-fluid mb-3">
            <div class="h3 lh-base fw-bold w-100 header-text text-center">ADMIN<br>THAILAND LOCKSMITH 2025
            </div>
        </header>
        <main class="container-fluid m-0 p-0">
            <section id="page1" class="pages d-none">
                <div class="row g-4">
                    <div class="col-12">
                        <button
                            class="btn btn-card btn-orange w-100 fw-bold d-flex align-items-center justify-content-between scan-card"
                            disabled id="scan-in-btn">
                            <span class="flex-grow-1 text-start ps-2">
                                <div class="fs-5">‡∏™‡πÅ‡∏Å‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</div>
                                <div class="fs-6" style="opacity: 0.9;">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</div>
                            </span>
                            <span class="btn-icon">
                                <i class="bi bi-qr-code-scan fs-5"></i>
                            </span>
                        </button>
                    </div>
                    <div class="col-12">
                        <div class="card-modern">
                            <div class="text-center mb-3">
                                <i class="bi bi-people-fill fs-1" style="color: #ff8f04;"></i>
                                <h4 class="mt-2" style="color: #000000; font-weight: 700;">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</h4>
                            </div>
                            <div class="table-responsive">
                                <table id="customer-in-table" class="table table-striped table-bordered table-hover"
                                    style="width: 100%">
                                    <thead class="table-warning"></thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section>
                <!-- full screen modal with table for datatable -->
                <div class="modal fade" id="user-in" tabindex="-1" aria-labelledby="user-inLabel" aria-hidden="true">
                    <div class="modal-dialog modal-fullscreen modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="user-inLabel">
                                    <img src="https://img2.pic.in.th/pic/1763797945554.png" alt=""
                                        style="width: 35px; max-height: 35px;" class="img-fluid">
                                    ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
                                <button type="button" class="btn btn-primary" id="user-in-refresh-btn">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
    <script>
        $(document).ready(function () {
            let page = new URLSearchParams(window.location.search).get('p');
            page = page == null ? 1 : page;
            if (page) {
                changePage(page);
            }
        });
        function changePage(page) {
            $('.pages').addClass('d-none');
            $('#page' + page).removeClass('d-none');
        }
    </script>
    <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
    <script>
        // VConsole will be exported to `window.VConsole` by default.
        // var vConsole = new window.VConsole();
    </script>

    <script>
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbxeQVWU7m3laqQowhev9487Ize_SAW8zy7qj-IlneYSz-DHwUBMnpb73CTnVc9ADFg/exec'

        const LIFF_ID = '1656187634-ZrAvz5Q9'
        var folder_token_obj, auth_users
        $(document).ready(() => {
            $.LoadingOverlay("show");
            liff.init({
                liffId: LIFF_ID,
                withLoginOnExternalBrowser: true
            })
            liff.ready.then(() => {
                // console.log(liff.getContext());
                // if (liff.getOS() != 'android' && liff.getContext().type != 'external') {
                //     liff.openWindow({ url: liff.getContext().endpointUrl, external: true })
                //     liff.closeWindow()
                // }
                initApp();

            });
        })

        $('#cancel-btn').on('click', function () {
            progress = ''
            html5QrCode.stop()
            $('#qrdiv').addClass('d-none')
            $('#btn-div').removeClass('d-none')
        })

        function initApp() {
            Promise.all([
                $.post(scriptUrl, { opt: 'getAuth_users' }, function (res) {
                    auth_users = res
                    $.LoadingOverlay("hide");
                    $('#scan-in-btn').removeAttr('disabled')
                    console.log("üöÄ !! auth_users:", auth_users)
                }),
                $.post(scriptUrl, { opt: 'getCustomers_in' }, function (res) { setCustomers_in_Table(res) })
            ]).then(function (responses) {
                console.log('all done');
            }).catch(function (error) {
                console.error("Error fetching data:", error);
                $.LoadingOverlay("hide");
            });
            $('#scan-in-btn').click(() => {
                scancode()
            })
            $('#show-customers-in').click(() => {
                $('#user-in').modal('show')
            })

        }

        function setCustomers_in_Table(res) {
            console.log("üöÄ !! res:", res)
            $.LoadingOverlay("hide");
            $('#show-customers-in').removeAttr('disabled')
            $('#user-in').off('shown.bs.modal').on('shown.bs.modal', function () {
                console.log('shown.bs.modal');
                setTimeout(() => {
                    $('#customer-in-table').DataTable().columns.adjust().responsive.recalc();
                    $('#customer-in-table').DataTable().draw();
                }, 100);
            })
            if (res.status != 'success' || res.data.length == 0) res.data = []
            let header = res.header
            $('#customer-in-table').DataTable({
                data: res.data,
                buttons: {
                    buttons: [
                        {
                            // refresh btn
                            text: '<i class="bi bi-arrow-clockwise"></i> Refresh',
                            className: 'btn btn-info rounded-pill',
                            action: function (e, dt, node, config) {
                                $.LoadingOverlay('show')
                                $.post(scriptUrl, { opt: 'getCustomers_in' }, function (res) {
                                    $.LoadingOverlay('hide')
                                    Object.keys(auth_users).forEach(id => {
                                        let index = res.data.findIndex(r => r['‡∏£‡∏´‡∏±‡∏™‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤'] == id)
                                        if (index == -1) auth_users[id]['check-in'] = 'NO'
                                        else auth_users[id]['check-in'] = 'YES'
                                    })
                                    console.log("üöÄ !! auth_users:", auth_users)
                                    setCustomers_in_Table(res)
                                })
                            }
                        }
                    ],
                    dom: {
                        button: {
                            className: 'btn btn-primary rounded-pill'
                        }
                    }
                },
                columns: [
                    {
                        title: header[0],
                        data: header[0],
                        render: function (data, type, row, meta) {
                            if (data == '') return ''
                            if (type === 'display') {
                                return moment(data).format('DD/MM/YYYY HH:mm:ss')
                            }
                            return new Date(data).getTime()
                        }

                    },
                    {
                        title: header[1],
                        data: header[1],
                        // custimer id
                        render: function (data, type, row, meta) {
                            if (data == '') return ''
                            if (data.indexOf('#') == 0) return `<span class="badge" style="font-size: 1rem; background: linear-gradient(135deg, #ffad42 0%, #ff8f04 100%); color: #000; font-weight: 600;">${data}</span>`
                            return `<span class="badge" style="font-size: 1rem; background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%); color: #ff8f04; font-weight: 600; border: 1px solid #ff8f04;">${data}</span>`

                        }
                    },
                    {
                        title: header[2],
                        data: header[2],
                    },
                    {
                        title: header[3],
                        data: header[3],
                    },
                    {
                        title: header[4],
                        data: header[4],
                        render: function (data, type, row, meta) {
                            if (!data) return '';
                            const phones = data.toString().split(',').map(d => {
                                const clean = d.trim().padStart(10, '0').replace(/-/g, '');
                                return `<a href="tel:${clean}">${clean}</a>`;
                            }).join('<br>');
                            return `<span><i class="bi bi-telephone-fill"></i> ${phones}</span>`;
                        }
                    },
                    {
                        title: header[5],
                        data: header[5],
                    },
                    {
                        title: header[6],
                        data: header[6],
                    },
                    {
                        title: header[7],
                        data: header[7],
                    },
                    {
                        title: header[8],
                        data: header[8],
                    },
                    {
                        title: header[9],
                        data: header[9],

                    }
                ],
                "order": [[0, "desc"]],
                "language": {
                    "emptyTable": "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•",
                    "info": "‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• _START_ ‡∏ñ‡∏∂‡∏á _END_ ‡∏à‡∏≤‡∏Å _TOTAL_ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",
                    "infoEmpty": "‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 0 ‡∏ñ‡∏∂‡∏á 0 ‡∏à‡∏≤‡∏Å 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",
                    "infoFiltered": "(‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• _MAX_ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)",
                    "lengthMenu": "‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• _MENU_ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",
                    "search": "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤:",
                    "zeroRecords": "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£",
                    "paginate": {
                        "first": "‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å",
                        "last": "‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢",
                        "next": "‡∏ñ‡∏±‡∏î‡πÑ‡∏õ",
                        "previous": "‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤"
                    },
                },
                "pageLength": 10,
                "destroy": true,
                // "scrollX": true,
                // "scrollCollapse": true,
                "fixedHeader": true,
                "responsive": true,
                columnDefs: [
                    {
                        targets: '_all',
                        className: 'dt-head-center dt-head-nowrap'
                    },

                    {
                        targets: [1, 2, 5],
                        className: 'all dt-body-center',
                        responsivePriority: 1
                    },
                    {
                        targets: [9],
                        visible: false,
                    },
                    {
                        targets: [0, 1],
                        className: 'text-nowrap',
                    }
                ],
                "dom": '<"row justify-content-between"<"col-5 col-md-auto"B><"col-7 col-md-auto ml-auto search">>' +
                    '<"row mt-2"<"col-12"tr>>' +
                    '<"row justify-content-between mt-3 "<"col-6 col-md-auto"i><"col-6 col-md-auto"p>>',
                initComplete: function () {
                    $('.search').html('<input type="search" class="form-control" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...">')
                    $('.search input').on('keyup', function () {
                        $('#customer-in-table').DataTable().search(this.value).draw()
                    })
                }
            })

        }

        function scancode() {
            let os = liff.getOS()
            console.log("üöÄ !! os:", os)
            if (os == 'web') {
                initSelfInput()
            } else if (os == 'ios') {
                initQrCode()
                // liff.scanCodeV2()
                //     .then((result) => {
                //         processData(result, type)
                //     })
            } else if (os == 'android') {
                liff.scanCodeV2()
                    .then((result) => {
                        processData(result)
                    })
            }
        }

        function processData(scan_text, callback = false) {
            console.log("üöÄ !! scan_text:", scan_text)
            if ($('#qrdiv').is(':visible')) $('#qrdiv').addClass('d-none')
            if ($('#btn-div').is(':hidden')) $('#btn-div').removeClass('d-none')
            let id = scan_text.value.toUpperCase()
            if (id == null || id == '') return
            if (auth_users[id]) {
                if (!auth_users[id]['uid']) {
                    return Swal.fire({
                        icon: 'error',
                        title: '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô',
                        html: `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ <span class="text-danger fw-bold">${id}</span> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô <br><a href="tel:0891109020">089-110-9020</a> <br><a href="tel:028681990">02-868-1990</a>`,
                        confirmButtonText: '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö',
                        allowOutsideClick: false,
                        customClass: { popup: 'rounded-4' }
                    }).then(() => {
                        scancode('checkin')
                    })
                }
                let table_data = $('#customer-in-table').DataTable().data().toArray()
                console.log("üöÄ !! table_data:", table_data)
                if (table_data.length > 0) {
                    let index = table_data.findIndex(r => r['‡∏£‡∏´‡∏±‡∏™‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤'] == id && moment(r['‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤']).isSame(moment(), 'day'))
                    console.log("üöÄ !! index:", index)
                    if (index > -1) {
                    console.log(moment(table_data[index]['‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤']).format('DD/MM/YYYY'), moment().format('DD/MM/YYYY'))
                        Swal.fire({
                            icon: 'error',
                            title: '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß',
                            html: `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ <span class="text-danger fw-bold">${id}</span> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß`,
                            confirmButtonText: '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö',
                            allowOutsideClick: false,
                            customClass: { popup: 'rounded-4' }
                        }).then(() => {
                            scancode('checkin')
                        })

                        return;
                    }
                }
                $.LoadingOverlay("show");
                $.post(scriptUrl, { opt: 'checkin', id: id, uid: liff.getDecodedIDToken().sub }, function (res) {
                    console.log("üöÄ !! res:", res)
                    $.LoadingOverlay("hide");
                    if (res.status == 'success') {
                        // google.script.run.sendWelcomeMessage(res.uid)
                        $.post(scriptUrl, { opt: 'sendWelcomeMessage', uid: res.uid }, function (res) {
                            console.log("üöÄ !! sendWelcomeMessage res:", res)
                        })
                        $('#customer-in-table').DataTable().row.add(res.data).draw(false)
                        Swal.fire({
                            title: '‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                            html: `<div class="container-fluid">
                                        <div class="row justify-content-center">
                                            <div class="col-12 text-center">
                                                <div class="h3 fw-bold mt-2">${auth_users[id]['‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•']}</div>
                                            </div>
                                            <div class="col-12 text-center">
                                                <div class="fw-bold">${auth_users[id]['‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î']}</div>
                                            </div>
                                        </div>
                                    </div>`,
                            allowOutsideClick: false,
                            showCancelButton: true,
                            confirmButtonText: '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö',
                            cancelButtonText: liff.getOS() == 'web' ? '‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á',
                            confirmButtonColor: '#7ed957',
                            cancelButtonColor: '#d33',
                            reverseButtons: true,
                            timer: 1000 * 60 * 20,
                            customClass: { popup: 'rounded-4' }
                        }).then((result) => {
                            auth_users[id]['Check-in'] = 'Yes'
                            if (result.isConfirmed) {
                                scancode()
                            }
                        })

                    } else if (res.status == 'already checked') {
                        return Swal.fire({
                            icon: 'error',
                            title: '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥',
                            confirmButtonText: '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö',
                            showCancelButton: true,
                            cancelButtonText: liff.getOS() == 'web' ? '‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á',
                            allowOutsideClick: false,
                            reverseButtons: true,
                            customClass: { popup: 'rounded-4' }
                        })
                    } else if (res.status == 'no auth') {
                        Swal.fire({
                            icon: 'error',
                            title: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô',
                            html: `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ <span class="text-danger fw-bold">${id}</span> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô`,
                            confirmButtonText: '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö',
                            showCancelButton: true,
                            cancelButtonText: liff.getOS() == 'web' ? '‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á',
                            allowOutsideClick: false,
                            reverseButtons: true,
                            customClass: { popup: 'rounded-4' }
                        }).then(() => {
                            scancode('checkin')
                        })
                    } else if (res.status == 'not allowed') {
                        return Swal.fire({
                            icon: 'error',
                            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                            text: res.message,
                            confirmButtonText: '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö',
                            allowOutsideClick: false,
                            customClass: { popup: 'rounded-4' }
                        })
                    }
                })


            } else {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô',
                    html: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô <br><a href="tel:0891109020">089-110-9020</a> <br><a href="tel:028681990">02-868-1990</a>',
                    confirmButtonText: '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö',
                    showCancelButton: true,
                    cancelButtonText: liff.getOS() == 'web' ? '‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á',
                    reverseButtons: true,
                    allowOutsideClick: false,
                    customClass: { popup: 'rounded-4' }
                }).then(() => {
                    scancode('checkin')
                })
            }
        }

    </script>

    <script>
        const config = { fps: 30, aspectRatio: 1.777778 };
        // This method will trigger user permissions
        var html5QrCode
        function initQrCode(type) {
            html5QrCode = new Html5Qrcode("reader");
            const qrCodeSuccessCallback = message => {
                html5QrCode.stop().then(ignore => {
                    console.log("üöÄ ~ message", message)
                    return processData({ value: message }, type)
                }).catch(err => {
                    // Stop failed, handle it.
                });
            }
            $('#qrdiv').removeClass('d-none')
            $('#btn-div').addClass('d-none')
            html5QrCode.start({ facingMode: "environment" }, config, qrCodeSuccessCallback);
        }

        function initSelfInput() {
            Swal.fire({
                title: '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤',
                input: 'text',
                inputAttributes: {
                    autocapitalize: 'off'
                },
                customClass: {
                    input: 'rounded text-center',
                    popup: 'rounded-4'
                },
                didOpen: () => {
                    const input = Swal.getInput()
                    $(input).attr('maxlength', 10).css('font-size', '1.5rem')
                    $(input).on('input', _.debounce(function (e) {
                        this.value = this.value.toUpperCase();
                    }, 100));
                },
                showCancelButton: true,
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                showLoaderOnConfirm: true,
                allowOutsideClick: false,
                autoFocus: true,
                preConfirm: (id) => {
                    return id.toUpperCase()
                },
                inputValidator: (id) => {
                    if (!id) {
                        return '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤'
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    processData({ value: result.value })
                }
            })
        }
    </script>
    <script>
        // form validation
        (() => {
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            const forms = document.querySelectorAll('.needs-validation')

            // Loop over them and prevent submission
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    event.preventDefault()
                    if (!form.checkValidity()) {
                        event.stopPropagation()
                        form.classList.add('was-validated')
                        $(form).find(":invalid").first().focus();
                    } else {
                        if ($(form).attr('id') == 'authen-form') {
                            userValidate();
                        } else if ($(form).attr('id') == 'register-form') {
                            userRegister();
                        }
                    }

                })
            })
        })()
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <!-- vconsole -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vConsole/3.9.1/vconsole.min.js"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.0.1/html5-qrcode.min.js"
        integrity="sha512-JXdlXFkKGAhP2yUubNT7hXNjEtPrAJz1Gs7oztdP47KhqL5ux88uof5FnIm2D0Ud/TdqiAe1mM1179kJDy/HKA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/moment.min.js"></script>
     <script src="https://liffsdk.line-scdn.net/xlt/manifest.json?ver=123456"></script>
</body>

</html>
